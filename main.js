/* ---------- QUESTIONS (replace with your 100 later) ---------- */
/* ---------- QUESTIONS (replace with your 100 later) ---------- */
let QUESTIONS = [
  {
    text: "In 2019, in which country did a 34-year-old woman become the world's youngest Prime Minister?",
    options: [
      "New Zealand - Jacinda Ardern",
      "Finland - Sanna Marin",
      "Italy - Giorgia Meloni",
      "Australia - Julia Gillard",
    ],
    answerIndex: 1,
  },
  {
    text: "Which of these terms in fashion gets its name from a town in France?",
    options: ["Linen", "Jersey", "Jeans", "Denim"],
    answerIndex: 3,
  },
  {
    text: "In which game players try to keep the ball always up and in the air?",
    options: ["Cricket", "Hockey", "Football", "Volleyball"],
    answerIndex: 3,
  },
  {
    text: "A publication started in 1935 was named after which bird?",
    options: ["Penguin", "Peacock", "Eagle", "Dove"],
    answerIndex: 0,
  },
  {
    text: "What is the name of the first child of a sitting US President to have been born in the White House?",
    options: [
      "Robert Tyler",
      "Esther Cleveland",
      "Robert Todd Lincoln",
      "Caroline Kennedy",
    ],
    answerIndex: 1,
  },
  {
    text: "Which of these is the largest living reptile by weight?",
    options: [
      "Komodo dragon",
      "Saltwater crocodile",
      "Monitor lizard",
      "Anaconda",
    ],
    answerIndex: 1,
  },
  {
    text: "The English name for which of these items has its origin in an Indian language?",
    options: ["Ginger", "Banana", "Pumpkin", "Coffee"],
    answerIndex: 0,
  },
  {
    text: "Who among these has written books titled 'Becoming' and 'The Light We Carry'?",
    options: [
      "Michelle Obama",
      "Hillary Clinton",
      "Oprah Gail Winfrey",
      "Melania Trump",
    ],
    answerIndex: 0,
  },
  {
    text: "Which animal has the heaviest and largest brain?",
    options: ["Blue Whale", "Sperm Whale", "Humpback whale", "Orca"],
    answerIndex: 1,
  },
  {
    text: "Nicholas Sarkozy, who was sentenced to jail on grounds of corruption in March 2021, is the former President of which country?",
    options: ["Belgium", "France", "Norway", "Poland"],
    answerIndex: 1,
  },
  {
    text: "Premier League, La Liga, Serie A are some of the top most leagues associated with which game?",
    options: ["Handball", "Cricket", "Netball", "Football"],
    answerIndex: 3,
  },
  {
    text: "In 2021, Anita Anand took charge as the Minister of National Defence of which country?",
    options: ["Canada", "Norway", "United Kingdom", "Fiji"],
    answerIndex: 0,
  },
  {
    text: "Which of these English phrases means 'to finish something spectacularly'?",
    options: [
      "Apple of the eye",
      "Tit for tat",
      "Time is money",
      "Go out with a bang",
    ],
    answerIndex: 3,
  },
  {
    text: "Who is the author of War and Peace?",
    options: [
      "Leo Tolstoy",
      "William Shakespeare",
      "Fyodor Dostoevsky",
      "Charles Dickens",
    ],
    answerIndex: 0,
  },
  {
    text: "To whom did Dr APJ Abdul Kalam pay tribute in his first address in 2003 to the Parliament as the President of India?",
    options: [
      "Dr Vikram Sarabhai",
      "Dr Homi J Bhabha",
      "Prof Satish Dhawan",
      "Kalpana Chawla",
    ],
    answerIndex: 3,
  },
  {
    text: "In 2021, Bhavani Devi became the first Indian to qualify for which Olympic event?",
    options: ["Equestrian", "Cycling", "Canoeing", "Fencing"],
    answerIndex: 3,
  },
  {
    text: "Which is the oldest of the seven wonders of the Ancient world?",
    options: [
      "Temple of Artemis",
      "Pyramid of Giza",
      "Statue of Zeus",
      "Pharos of Alexandria",
    ],
    answerIndex: 1,
  },
  {
    text: "Which common portfolio have Rajnath Singh, Nirmala Sitharaman and Arun Jaitley all held in the Union cabinet?",
    options: ["Home", "Finance", "Defence", "Law & Justice"],
    answerIndex: 2,
  },
  {
    text: "If you were buying something in Rubles, in which of these countries would you most likely be?",
    options: ["Germany", "Russia", "Egypt", "Japan"],
    answerIndex: 1,
  },
  {
    text: "Which of these is common to the Prime Minister of the UK and the Vice President of the USA, as of October 2022?",
    options: [
      "Both are Women",
      "Both are Men",
      "Both are below 40 years of age",
      "Both are Indian descent",
    ],
    answerIndex: 3,
  },
  {
    text: "What material was Michelangelo's David sculpted from?",
    options: ["Wood", "Glass", "Iron", "Marble"],
    answerIndex: 3,
  },
  {
    text: "Which of these is not a Japanese island?",
    options: ["Fiji", "Shikoku", "Kyushu", "Okinawa"],
    answerIndex: 0,
  },
  {
    text: "Which of these companies was the first to record a market capitalization of over one trillion dollars?",
    options: ["PetroChaina", "Apple", "Saudi Aramco", "IBM"],
    answerIndex: 0,
  },
  {
    text: "John Lennon and Ringo Starr were a part of which band?",
    options: ["Queen", "The Beatles", "Led Zeppelin", "Black Sabbath"],
    answerIndex: 1,
  },
  {
    text: "After which revolutionary was the Vietnamese city of Saigon renamed?",
    options: ["Mao Zedong", "Ho Chi Minh", "Pol Pot", "Sun Yat-sen"],
    answerIndex: 1,
  },
  {
    text: "Which civilian astronaut was the first school teacher selected by NASA to travel to space?",
    options: [
      "Eileen Collins",
      "Anna Lee Fisher",
      "Christa McAuliffe",
      "Mae Jemison",
    ],
    answerIndex: 2,
  },
  {
    text: "Mount Fuji is the tallest mountain of which country?",
    options: ["Singapore", "Japan", "Thailand", "Indonesia"],
    answerIndex: 1,
  },
  {
    text: "Which is the widest river in the world?",
    options: ["Nile", "Yangtze", "Amazon", "Danube"],
    answerIndex: 2,
  },
  {
    text: "Which is the longest river in the world?",
    options: ["Nile", "Amazon", "Yangtze", "Missouri"],
    answerIndex: 0,
  },
  {
    text: "Which chemical element is named after a husband-wife duo?",
    options: ["Bohrium", "Curium", "Fermium", "Seaborgium"],
    answerIndex: 1,
  },
  {
    text: "Who among the following is not a Nobel prize winner?",
    options: [
      "Mahatma Gandhi",
      "Rabindranath Tagore",
      "C. V. Raman",
      "Mother Teresa",
    ],
    answerIndex: 0,
  },
  {
    text: "Which of these is an International Symbol of Peace?",
    options: ["Owl", "Crow", "Dove", "Duck"],
    answerIndex: 2,
  },
  {
    text: "Leaders like Zhou Elai, Deng Xiaoping, and Mao Zedong are from which country?",
    options: ["China", "Japan", "Taiwan", "Vietnam"],
    answerIndex: 0,
  },
  {
    text: "Christopher Hipkins became the Prime Minister of which country in 2023?",
    options: ["Australia", "New Zealand", "Brazil", "Jamaica"],
    answerIndex: 1,
  },
  {
    text: "Which teamâ€™s cricket World Cup winning captains include Steve Waugh and Ricky Ponting?",
    options: ["New Zealand", "England", "Australia", "West Indies"],
    answerIndex: 2,
  },
  {
    text: "In which city is the Parliament of India located?",
    options: ["Mumbai", "New Delhi", "Kolkata", "Ahmedabad"],
    answerIndex: 1,
  },
  {
    text: "The name of which of these countries and its capital starts with the same letter?",
    options: ["Chile", "New Zealand", "South Africa", "Belgium"],
    answerIndex: 3,
  },
  {
    text: "Who directed the film Gandhi?",
    options: [
      "Steven Spielberg",
      "James Cameron",
      "Christopher Nolan",
      "Richard Attenborough",
    ],
    answerIndex: 3,
  },
  {
    text: "Which actor played Mahatma Gandhi in the movie Gandhi?",
    options: [
      "Ben Kingsley",
      "Robert De Niro",
      "Daniel Day-Lewis",
      "Harrison Ford",
    ],
    answerIndex: 0,
  },
  {
    text: "Stephen Hawking wrote a book titled 'A Brief History of' what?",
    options: ["Time", "Space", "Life", "Gravity"],
    answerIndex: 0,
  },
  {
    text: "Which of these sporting events has not featured in some editions of the modern summer Olympic games?",
    options: ["Fencing", "Swimming", "Artistic Gymnastics", "Archery"],
    answerIndex: 3,
  },
  {
    text: "Which of these countries is located on the same continent as India?",
    options: ["Uganda", "Thailand", "Colombia", "New Zealand"],
    answerIndex: 1,
  },
  {
    text: "In which country the Buddha was born?",
    options: ["India", "China", "Thailand", "Nepal"],
    answerIndex: 3,
  },
  {
    text: "In which country did the Olympic games originate?",
    options: ["Greece", "Spain", "Italy", "Russia"],
    answerIndex: 0,
  },
  {
    text: "The island of Bali is part of which country?",
    options: ["Thailand", "Sri Lanka", "Indonesia", "Japan"],
    answerIndex: 2,
  },
  {
    text: "What is the national animal of Australia?",
    options: ["Emu", "Platypus", "Kangaroo", "Koala"],
    answerIndex: 2,
  },
  {
    text: "Who wrote the 'Harry Potter' series?",
    options: [
      "J. K. Rowling",
      "George R.R. Martin",
      "Stephenie Meyer",
      "George Orwell",
    ],
    answerIndex: 0,
  },
  {
    text: "How many states are in the United States of America?",
    options: ["50 States", "52 States", "45 States", "48 States"],
    answerIndex: 0,
  },
  {
    text: "In which sports is the player's height considered an advantage?",
    options: ["Football", "Basketball", "Cricket", "Hockey"],
    answerIndex: 1,
  },
  {
    text: "Which country has a bible on its flag?",
    options: ["Germany", "Dominican Republic", "Vatican City", "Greece"],
    answerIndex: 1,
  },
  {
    text: "Which country started the tradition of putting up a Christmas tree?",
    options: ["Germany", "U.S.A.", "United Kingdom", "United States", "France"],
    answerIndex: 0,
  },
  {
    text: "How old was Princess Diana when she died?",
    options: ["39 Years", "36 Years", "42 Years", "47 Years"],
    answerIndex: 1,
  },
  {
    text: "In which currency is 'In God We Trust' written?",
    options: ["United Kingdom", "United States", "Canada", "Australia"],
    answerIndex: 1,
  },
  {
    text: "Which Tamil singer was honoured by the United Nations by issuing a Postage stamp?",
    options: [
      "P. Susheela",
      "S. Janaki",
      "Bombay Jayashri",
      "M. S. Subbulakshmi",
    ],
    answerIndex: 3,
  },
  {
    text: "Who is the only Indian Carnatic music vocalist nominated for an Oscar 2013 in the original song category for Life of Pi lullaby?",
    options: [
      "P. Susheela",
      "S. Janaki",
      "Bombay Jayashri",
      "Nithyasree Mahadevan",
    ],
    answerIndex: 2,
  },
  {
    text: "What was the first country to allow women to vote?",
    options: ["United Kingdom", "United States", "New Zealand", "Australia"],
    answerIndex: 2,
  },
  {
    text: "The Red Cross was born in 1863 in what country?",
    options: ["Norway", "Switzerland", "United States", "United Kingdom"],
    answerIndex: 1,
  },
  {
    text: "Who has won the most Olympic medals?",
    options: [
      "Michael Phelps",
      "Larisa Latynina",
      "Marit Bjorgen",
      "Niokolay Andrianov",
    ],
    answerIndex: 0,
  },
  {
    text: "What was the nationality of the artist Picasso?",
    options: ["Italy", "Spain", "France", "Germany"],
    answerIndex: 1,
  },
  {
    text: "Which world leader was assassinated by members of her own bodyguard in 1984?",
    options: [
      "Margaret Thatcher",
      "Indira Gandhi",
      "Khaleda Zia",
      "Benazir Bhutto",
    ],
    answerIndex: 1,
  },
];

/* ---------- STATE ---------- */
const state = {
  name: "",
  current: 0,
  answers: [],
  correctCount: 0,
  startedAt: 0,
  finishedAt: 0,
  reviewing: false,
};

const els = {
  startScreen: document.getElementById("startScreen"),
  quizScreen: document.getElementById("quizScreen"),
  resultScreen: document.getElementById("resultScreen"),

  name: document.getElementById("studentName"),
  startBtn: document.getElementById("startBtn"),

  qCounter: document.getElementById("qCounter"),
  qText: document.getElementById("qText"),
  options: document.getElementById("options"),
  selectionStatus: document.getElementById("selectionStatus"),
  prevBtn: document.getElementById("prevBtn"),
  nextBtn: document.getElementById("nextBtn"),
  finishBtn: document.getElementById("finishBtn"),

  resTime: document.getElementById("resTime"),
  resPercent: document.getElementById("resPercent"),
  correctCount: document.getElementById("correctCount"),
  incorrectCount: document.getElementById("incorrectCount"),
  passTag: document.getElementById("passTag"),
  scoreRing: document.getElementById("scoreRing"),

  retryBtn: document.getElementById("retryBtn"),
  reviewBtn: document.getElementById("reviewBtn"),

  progressBadge: document.getElementById("progressBadge"),
  footerInfo: document.getElementById("footerInfo"),
};

const formatTime = (ms) => {
  const s = Math.floor(ms / 1000);
  const mm = String(Math.floor(s / 60)).padStart(2, "0");
  const ss = String(s % 60).padStart(2, "0");
  return `${mm}:${ss}`;
};

function setQuestions(list) {
  QUESTIONS = list.slice();
  els.progressBadge.textContent = `${QUESTIONS.length} questions`;
}

/* ---------- FLOW ---------- */
function startQuiz() {
  state.name = els.name.value.trim();
  if (!state.name) {
    showMessage("Please enter your name.");
    return;
  }
  if (!QUESTIONS.length) {
    showMessage("Please load questions first.");
    return;
  }

  state.current = 0;
  state.answers = Array(QUESTIONS.length).fill(null);
  state.correctCount = 0;
  state.startedAt = Date.now();
  state.finishedAt = 0;
  state.reviewing = false;

  els.startScreen.hidden = true;
  els.quizScreen.hidden = false;
  els.resultScreen.hidden = true;

  renderQuestion();
}

function renderQuestion() {
  const q = QUESTIONS[state.current];
  els.qCounter.textContent = `${state.current + 1}.`;
  els.qText.textContent = q.text;

  els.options.innerHTML = "";
  q.options.forEach((opt, idx) => {
    const label = document.createElement("label");
    label.className = "option";
    const radio = document.createElement("input");
    radio.type = "radio";
    radio.name = "option";
    radio.value = String(idx);
    radio.checked = state.answers[state.current] === idx;
    radio.disabled = state.answers[state.current] !== null;
    label.appendChild(radio);
    label.appendChild(document.createTextNode(opt));
    label.addEventListener("click", () => handleSelect(idx));
    els.options.appendChild(label);
  });

  els.prevBtn.disabled = state.current === 0;
  els.nextBtn.disabled = state.current === QUESTIONS.length - 1;
  els.finishBtn.disabled = state.answers.includes(null);

  paintFeedback();
  updateSelectionStatus();
}

function handleSelect(idx) {
  if (state.answers[state.current] !== null) return;
  state.answers[state.current] = idx;
  if (idx === QUESTIONS[state.current].answerIndex) state.correctCount++;

  paintFeedback();
  updateSelectionStatus();

  setTimeout(() => {
    if (state.current < QUESTIONS.length - 1) {
      state.current++;
      renderQuestion();
    } else if (!state.answers.includes(null)) {
      finishQuiz();
    }
  }, 420);
}

function paintFeedback() {
  const q = QUESTIONS[state.current];
  const chosen = state.answers[state.current];
  [...els.options.children].forEach((node, i) => {
    node.classList.remove("correct", "incorrect");
    const input = node.querySelector("input");
    input.disabled = chosen !== null;
    if (chosen !== null) {
      if (i === q.answerIndex) node.classList.add("correct");
      if (i === chosen && chosen !== q.answerIndex)
        node.classList.add("incorrect");
    }
  });
}

function updateSelectionStatus() {
  const chosen = state.answers[state.current];
  if (chosen === null) {
    els.selectionStatus.textContent = "not answered";
    els.finishBtn.disabled = true;
  } else {
    const ok = chosen === QUESTIONS[state.current].answerIndex;
    els.selectionStatus.textContent = ok ? "correct" : "incorrect";
    els.selectionStatus.style.color = ok
      ? "var(--correct)"
      : "var(--incorrect)";
    els.finishBtn.disabled = state.answers.includes(null);
  }
}

function prevQuestion() {
  if (state.current > 0) {
    state.current--;
    renderQuestion();
  }
}
function nextQuestion() {
  if (state.current < QUESTIONS.length - 1) {
    state.current++;
    renderQuestion();
  }
}

function finishQuiz() {
  if (state.answers.includes(null)) {
    showMessage("Answer all questions first.");
    return;
  }
  state.finishedAt = Date.now();

  const total = 60; // fixed total questions
  const correct = state.correctCount;
  const incorrect = total - correct;

  els.quizScreen.hidden = true;
  els.resultScreen.hidden = false;

  // âœ… Show just the numbers
  els.correctCount.textContent = correct;
  els.incorrectCount.textContent = incorrect;
  els.resPercent.textContent = correct; // Only the score number (e.g., 28)
  els.resTime.textContent = formatTime(state.finishedAt - state.startedAt);

  // Animate ring based on marks
  const percent = correct / total;
  animateRing(percent);
}

function animateRing(target) {
  let v = 0;
  const step = () => {
    v += (target - v) * 0.2;
    if (Math.abs(target - v) < 0.005) v = target;
    els.scoreRing.style.setProperty("--value", (v * 100).toFixed(2));
    if (v !== target) requestAnimationFrame(step);
  };
  requestAnimationFrame(step);
}

/* ---------- Utils ---------- */
function showMessage(text) {
  const container = document.getElementById("msgContainer");
  const msg = document.createElement("div");
  msg.className = "msg-error";
  msg.innerHTML = `<div class="bar"></div><div class="content"><p>${text}</p></div>`;
  container.appendChild(msg);
  setTimeout(() => {
    if (msg.parentNode) msg.remove();
  }, 4000);
}

/* ---------- Events ---------- */
els.startBtn.addEventListener("click", startQuiz);
els.prevBtn.addEventListener("click", prevQuestion);
els.nextBtn.addEventListener("click", nextQuestion);
els.finishBtn.addEventListener("click", finishQuiz);
els.retryBtn.addEventListener("click", () => {
  els.startScreen.hidden = false;
  els.quizScreen.hidden = true;
  els.resultScreen.hidden = true;
});
els.reviewBtn.addEventListener("click", () => {
  els.quizScreen.hidden = false;
  els.resultScreen.hidden = true;
  state.reviewing = true;
  state.current = 0;
  renderQuestion();
});

/* ---------- Init ---------- */
(function init() {
  // els.footerInfo.textContent = new Date().toLocaleString();
})();

